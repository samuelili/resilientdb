<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: Introduction</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/d84/md__2github_2workspace_2platform_2statistic_2README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introduction</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md201"></a>Nexres dynamic dashboard is a Grafana base dashboard for Nexres. It aims to provide a simple real-time interface for developers to monitor and diagnose Nexres. The data is stored in the Prometheus time-series database and queried by Grafana using PromeQL. The system usage data is provided by Prometheus third-party exporter Node Exporter.</p>
<h1><a class="anchor" id="autotoc_md202"></a>
Requirements</h1>
<p>Using Nexres dynamic dashboard requires the installation of Prometheus, Node Exporter, Prometheus-cpp, and Grafana. It has been successfully tested with Bazel building in C++17 on Ubuntu 20.04.4 LTS (Windows 11 WSL) and Visual Studio Code.</p>
<h1><a class="anchor" id="autotoc_md203"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md204"></a>
Install Prometheus</h2>
<p>go to <a href="https://prometheus.io/download/">https://prometheus.io/download/</a> download prometheus </p><div class="fragment"><div class="line">tar xvfz (your-prometheus-tar-file)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md205"></a>
Install node_exporter</h2>
<p>go to <a href="https://github.com/prometheus/node_exporter">https://github.com/prometheus/node_exporter</a> download the lastest version of node_exporter from release </p><div class="fragment"><div class="line">tar xvfz (your-node-exporter-tar-file)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md206"></a>
Install grafana</h2>
<div class="fragment"><div class="line">wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -</div>
<div class="line">sudo add-apt-repository &quot;deb https://packages.grafana.com/oss/deb stable main&quot;</div>
<div class="line">sudo apt update </div>
<div class="line">sudo apt install grafana</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md207"></a>
Change endpoint's server address</h2>
<p>Edit <a href="../..//example/start_kv_server.sh">example/start_kv_server.sh</a>, sets the new endpoint address in command line arguments.</p>
<h1><a class="anchor" id="autotoc_md208"></a>
Start the dashboard</h1>
<p>Prometheus endpoint starts automatically with nexres. To start nexres: </p><div class="fragment"><div class="line">sh example/kv_server.sh</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md209"></a>
Prometheus</h2>
<p>Default prometheus port is 9090 </p><div class="fragment"><div class="line">./prometheus</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md210"></a>
Node_exporter</h2>
<p>Default node exporter port is 9100 </p><div class="fragment"><div class="line">./node_exporter</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md211"></a>
Grafana</h2>
<p>Default grafana port is 3000 </p><div class="fragment"><div class="line">sudo service grafana-server start</div>
<div class="line">sudo service grafana-server enable</div>
</div><!-- fragment --><p> <em>Stop grafana: sudo service grafana-server stop</em></p>
<h1><a class="anchor" id="autotoc_md212"></a>
Configure prometheus</h1>
<h2><a class="anchor" id="autotoc_md213"></a>
Add prometheus endpoint:</h2>
<p>Edit “prometheus.yml” under your prometheus folder add the following code after “scrape_configs” </p><div class="fragment"><div class="line">- job_name: &quot;your_job_name&quot;</div>
<div class="line">    static_configs:</div>
<div class="line">      - targets: [&quot;your_ip_address:port&quot;]</div>
</div><!-- fragment --><p> Here is the current “scrape_configs” structure, you can find this yml file at <a href="../..//documents/file/prometheus.yml">here</a>.</p>
<p><img src="../..//documents/image/dashboard/yml_config.png" alt="yam_config" class="inline"/></p>
<p>After setup your endpoint information, restart prometheus.</p>
<h2><a class="anchor" id="autotoc_md214"></a>
Change prometheus scraping interval:</h2>
<p>change scrape_interval and evaluation_interval.</p>
<p><img src="../..//documents/image/dashboard/yml_interval.png" alt="yml_interval" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md215"></a>
Prometheus target:</h2>
<p>To check your endpoint status. Start prometheus, go to localhost:9090, and click Targets under Status menu.</p>
<p><img src="../..//documents/image/dashboard/target.png" alt="target" class="inline"/></p>
<p>This page shows all your endpoints' status. If the endpoint does not show up on this page, remember to set up your endpoint information in prometheus.yml and restart the database.</p>
<p><img src="../..//documents/image/dashboard/target%20list.png" alt="target_list" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md216"></a>
Setup grafana:</h1>
<h2><a class="anchor" id="autotoc_md217"></a>
Prometheus connection</h2>
<p>Please follow this link to set up the connection between grafana and prometheus. </p><blockquote class="doxtable">
<p>&zwj;<a href="https://prometheus.io/docs/visualization/grafana/">https://prometheus.io/docs/visualization/grafana/</a> </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md218"></a>
Import Nexres dynamic dashboard.</h2>
<p>Locate the import button under create menu.</p>
<p><img src="../..//documents/image/dashboard/import.png" alt="import" class="inline"/></p>
<p>Download the grafana json from this <a href="../..//documents/file/Nexres-1654906717062.json">link</a> and import to grafana.</p>
<h2><a class="anchor" id="autotoc_md219"></a>
Change plot</h2>
<p>Go to grafana configuration and click data source. Select your prometheus database and click to change setting, locate "Scrape interval" and change it to 5s.</p>
<p><img src="../..//documents/image/dashboard/resolution.png" alt="resolution" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md220"></a>
Prometheus metrics development:</h1>
<p>All the prometheus endpoint code and metrics builder are located under Stats class. There are three types of metric variables you can utilize according to the demand. They are Counter, Gauge, and Histogram. You can discover their using scenario in this <a href="https://prometheus.io/docs/concepts/metric_types/">link</a>.</p>
<p>To properly integrate these metric types to the code, check prometheus-cpp documentation (<a href="https://jupp0r.github.io/prometheus-cpp/">Documentation</a>, <a href="https://github.com/jupp0r/prometheus-cpp">Example</a>). Here is an example of starting a prometheus endpoint and adding a metric to the database.</p>
<p>Create a server running on port 8080 </p><div class="fragment"><div class="line">Exposer exposer{&quot;127.0.0.1:8080&quot;};</div>
</div><!-- fragment --><p>Create a metrics registry (make sure it is always alive) </p><div class="fragment"><div class="line">auto registry = std::make_shared&lt;Registry&gt;();</div>
</div><!-- fragment --><p>Add a new gauge family to the registry (you can change this part to other metric type as needed) </p><div class="fragment"><div class="line">auto&amp; packet_counter = BuildGauge()</div>
<div class="line">                        .Name(&quot;observed_packets_total&quot;)</div>
<div class="line">                        .Help(&quot;Number of observe packets&quot;)</div>
<div class="line">                        .Register(*registry);</div>
</div><!-- fragment --><p>Add and remember dimensional data </p><div class="fragment"><div class="line">auto&amp; tcp_rx_gauge =</div>
<div class="line">      packet_counter.Add({{&quot;protocol&quot;, &quot;tcp&quot;}, </div>
<div class="line">      {&quot;direction&quot;, &quot;rx&quot;}});</div>
</div><!-- fragment --><p>Ask the exposer to scrape the registry on incoming HTTP requests </p><div class="fragment"><div class="line">exposer.RegisterCollectable(registry);</div>
</div><!-- fragment --><p>Set numerical value to gauge variable </p><div class="fragment"><div class="line">tcp_rx_gauge.Set(123);</div>
</div><!-- fragment --><p>To setup these variables in header file, following the code structure in <a href="../..//statistic/stats.h">Stats.h</a>.</p>
<h1><a class="anchor" id="autotoc_md221"></a>
Testing</h1>
<h2><a class="anchor" id="autotoc_md222"></a>
Set random data into nexres</h2>
<div class="fragment"><div class="line">bazel run statistic/set_random_data &lt;test/loop&gt; &lt;value&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md223"></a>
Bazel build</h2>
<p>Run this command at nexres directory </p><div class="fragment"><div class="line">bazel build ...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md224"></a>
Bazel test</h2>
<p>Run this command at nexres directory </p><div class="fragment"><div class="line">bazel test ...</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md225"></a>
Future works</h1>
<ul>
<li>Research and discover more performance metrics into the dashboard.</li>
<li>Propose a script that could automatically fetch all servers' addresses and generate prometheus.yml file to serve nexres instances on cloud.</li>
<li>Establish a safe connection to prometheus endpoint by using reverse proxy through Nginx.</li>
<li>Explore grafana technique for better visualization</li>
<li>Integrate dashboard into nexres deployment portal page. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
